@page "/reporte-movimientos"
@inject SupabaseService Datos
@inject IJSRuntime JS

<h3 class="titulo-pagina">📅 Movimientos Entre Fechas</h3>

<div class="filtros mb-3 no-print">
    <label>Desde:</label>
    <input type="date" @bind="fechaDesde" class="form-control d-inline-block w-auto mx-2" />
    <label>Hasta:</label>
    <input type="date" @bind="fechaHasta" class="form-control d-inline-block w-auto mx-2" />
    <button class="btn btn-primary me-2" @onclick="CargarMovimientos">Buscar</button>
    <button class="btn btn-secondary" @onclick="Imprimir">🖨️ Imprimir</button>
</div>

@if (movimientos.Any())
{
    <table class="table table-striped table-sm">
        <thead>
            <tr>
                <th>Fecha</th>
                <th>Apellido</th>
                <th>Nombre</th>
                <th>Documento</th>
                <th>Detalle</th>
                <th>Observaciones</th>
                <th class="text-end">Debe</th>
                <th class="text-end">Haber</th>
            </tr>
        </thead>
        <tbody>
            @foreach (var m in movimientos)
            {
                <tr>
                    <td>@m.Fecha.ToString("dd/MM/yyyy")</td>
                    <td>@m.SocioApellido</td>
                    <td>@m.SocioNombre</td>
                    <td>@m.Documento</td>
                    <td>@m.Detalle</td>
                    <td>@m.Observaciones</td>
                    <td class="text-end">@m.Debe?.ToString("N2")</td>
                    <td class="text-end">@m.Haber?.ToString("N2")</td>
                </tr>
            }

            <tr class="fw-bold table-light">
                <td colspan="6" class="text-end">Totales:</td>
                <td class="text-end">@TotalDebe.ToString("N2")</td>
                <td class="text-end">@TotalHaber.ToString("N2")</td>
            </tr>
        </tbody>
    </table>
}
else if (buscado)
{
    <div class="alert alert-info">No hay movimientos en el rango seleccionado.</div>
}

@code {
    private DateTime fechaDesde = DateTime.Today.AddMonths(-1);
    private DateTime fechaHasta = DateTime.Today;
    private List<MovimientoConSocio> movimientos = new();
    private bool buscado = false;

    private decimal TotalDebe => movimientos.Sum(m => m.Debe ?? 0);
    private decimal TotalHaber => movimientos.Sum(m => m.Haber ?? 0);

    private async Task CargarMovimientos()
    {
        movimientos = await Datos.GetMovimientosEntreFechasConSocioAsync(fechaDesde, fechaHasta);
        buscado = true;
    }

    private async Task Imprimir()
    {
        await JS.InvokeVoidAsync("window.print");
    }
}
<style>
    @@media print {
        @@page {
            margin: 10mm 10mm 10mm 10mm; /* arriba, derecha, abajo, izquierda */
        }

        body {
            margin: 0;
            padding: 0;
            font-size: 12px;
        }

        .no-print,
        .btn,
        .navbar,
        .titulo-pagina {
            display: none !important;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            margin: 0; /* 👈 elimina márgenes externos */
            padding: 0; /* 👈 elimina padding externo */
            position: relative; /* 👈 evita centrado automático */
            left: 0; /* 👈 fuerza alineación a la izquierda */
        }

        th, td {
            border: 1px solid #999;
            padding: 4px 6px;
        }

        th {
            background-color: #f2f2f2;
        }

        tr:last-child {
            font-weight: bold;
            background-color: #eaeaea;
        }
    }
</style>

